# Plan for Creating `@textnav/urllog` NPX Package

This document outlines the steps to create the `@textnav/urllog` NPX package, which will be a standalone version of the `inspect.ts` script.

## 1. Initialize with Vite:

*   **Action:** Use Vite to scaffold a basic TypeScript project within the current directory (`/home/mstouffer/repos/urllog`).
*   **Template:** `vanilla-ts`
*   **Command:** `npm create vite@latest . -- --template vanilla-ts`
    *   This command does the following:
        *   `npm create vite@latest`: Uses the latest version of the `create-vite` package to initialize a new project.
        *   `.`: Specifies the current directory as the project root.
        *   `--`: Separates `npm create` options from the template options.
        *   `--template vanilla-ts`: Specifies the `vanilla-ts` template, which sets up a basic TypeScript project without any specific framework.

## 2. Install Dependencies:

*   **Action:** Install the necessary dependencies for the project.
*   **Dependencies:**
    *   `@playwright/test`: For browser automation.
    *   `rimraf`: For cross-platform directory removal.
    *   `typescript`: For TypeScript compilation (likely already included by Vite, but we'll include it for clarity).
    *   `@types/node`: For Node.js type definitions.
*   **Command:** `npm install @playwright/test rimraf typescript @types/node`

## 3. Move and Adapt Code:

*   **Action:** Move the existing `inspect.ts` file to the `src` directory and rename it to `index.ts`. Then, update the code for the new environment.
*   **Steps:**
    1.  Move `inspect.ts` to `src/index.ts`.
    2.  Update the shebang line at the top of `src/index.ts` to: `#!/usr/bin/env node`
    3.  Adjust file paths within `src/index.ts` (for output) to be relative to the project root. We'll use a default output directory (e.g., `urllog-output`) for now, and address configurability later.

## 4. Configure `package.json`:**

*   **Action:** Modify the `package.json` file generated by Vite to include necessary metadata and scripts for the NPX package.
*   **Changes:**
    *   Set the `name` field to `@textnav/urllog`.
    *   Set the `version` field to `0.1.0` (or another appropriate initial version).
    *   Set the `description` field to a brief description of the package.
    *   Set the `license` field to `Apache-2.0` (to match the `handterm` project).
    *   Add a `bin` field to specify the executable script:
        ```json
        "bin": {
          "urllog": "dist/index.js"
        }
        ```
    *   Add a `build` script to compile the TypeScript code using Vite: `"build": "vite build"`.
    *   Add a `prepare` script to automatically build the project before publishing: `"prepare": "npm run build"`.

## 5. Configure Vite (`vite.config.ts`):

*   **Action:** Configure Vite to build the project as a library, suitable for use as a command-line tool.
*   **Changes:**
    *   Modify `vite.config.ts` to include the `build.lib` options:
        ```typescript
        import { defineConfig } from 'vite';
        import { resolve } from 'path';

        export default defineConfig({
          build: {
            lib: {
              entry: resolve(__dirname, 'src/index.ts'), // Entry point
              name: 'urllog', // Global variable name (not used in CJS)
              formats: ['cjs'], // Output format: CommonJS
              fileName: (format) => `index.js`, // Output file name
            },
            rollupOptions: {
                // make sure to externalize deps that shouldn't be bundled
                external: ['playwright', 'fs', 'path', 'rimraf'],
            },
            outDir: 'dist', // Output directory
          },
        });
        ```

## 6. Configure TypeScript (`tsconfig.json`):

*   **Action:** Ensure the `tsconfig.json` file is configured correctly for a Node.js environment.
*   **Changes:**
    *   Verify/adjust the `compilerOptions` in `tsconfig.json`:
        ```json
        {
          "compilerOptions": {
            "target": "ES2020", // Or a suitable Node.js version
            "module": "CommonJS",
            "moduleResolution": "node",
            "esModuleInterop": true,
            "forceConsistentCasingInFileNames": true,
            "strict": true,
            "skipLibCheck": true,
            "outDir": "dist", // Output directory
            "rootDir": "src",  // Root directory of source files
            "declaration": true // Generate declaration files
          },
          "include": ["src/**/*"],
          "exclude": ["node_modules"]
        }
        ```

## 7. Test Locally:

*   **Action:** Test the package locally using `npm link`.
*   **Steps:**
    1.  Run `npm link` in the project directory (`/home/mstouffer/repos/urllog`). This creates a symbolic link in the global `node_modules` directory that points to the local project.
    2.  Open a *new* terminal (outside the project directory).
    3.  Run `npx @textnav/urllog`. This will execute the linked package. (Note: This will likely fail initially due to the hardcoded URL, but it tests the basic setup.)